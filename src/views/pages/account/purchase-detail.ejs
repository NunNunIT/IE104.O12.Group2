<!DOCTYPE html>
<html lang="vi">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="shortcut icon" type="ico" href="/imgs/ico-logo-blue.png" />
	<link rel="stylesheet" href="/styles/pages/account/purchase-detail.css">

	<title>TECHTWO.</title>
</head>

<body>

	<%- include('../../partials/header', { header: header }) %>
	<%- include('../../partials/breadcrumb', { breadcrumbs : [{ text : 'Trang cá nhân', link : '/account/information' }, { text : 'Lịch sử đơn mua', link : '/account/purchase' }, { text : 'Chi tiết đơn mua', link : '' }] }) %>

	<main class="account-container">
		<%- include("../../components/sidebar_account") %>

		<section class="purchase-detail__main">
			<div class="purchase-detail--top">
				<div class="purchase-detail__info">
					<h4>Chi tiết đơn hàng:</h4>
					<p id="purchase-detail__id">#DH00<%= purchaseHistory.order_id ?? 'NaN' %></p>
				</div>
				<div class="purchase-detail__status-container">
					<span class="material-symbols-outlined">
						<% if (purchaseHistory.order_status === 'Đã hủy') { %>
						cancel
						<% } else if (purchaseHistory.order_status === 'Chờ thanh toán') { %>
						payment
						<% } else if (purchaseHistory.order_status === 'Hoàn thành') { %>
						done_all
						<% } else if (purchaseHistory.order_status === 'Đang giao hàng') { %>
						local_shipping
						<% } %>
					</span>
					<p class="purchase-detail__status"><%= purchaseHistory.order_status ?? 'NaN' %></p>
				</div>
			</div>
			<div class="purchase-detail__date-time">
				<p>Đặt lúc:</p>
				<p id="purchase-detail__time"><%= formatFunction.toHHMM(new Date(purchaseHistory.order_date)) ?? 'NaN' %></p>
				<p id="purchase-detail__date"><%= formatFunction.toDDMMYYYY(new Date(purchaseHistory.order_date)) ?? 'NaN' %></p>
			</div>
			<div class="purchase-detail__order-info">
				<div class="purchase-detail__order-info__user">
					<h5>
						<span class="material-symbols-outlined">pin_drop</span>
						<span>THÔNG TIN NHẬN HÀNG</span>
					</h5>
					<div class="purchase-detail__order-info__user-detail">
						<span class="order-info__label">Người nhận:</span>
						<p id="user-detail__name"><%= purchaseHistory.order_name ?? 'NaN' %></p>
					</div>
					<div class="purchase-detail__order-info__user-detail">
						<span class="order-info__label">Số điện thoại:</span>
						<p id="user-detail__phone"><%= purchaseHistory.order_phone ?? 'NaN' %></p>
					</div>
					<div class="purchase-detail__order-info__user-detail">
						<span class="order-info__label">Địa chỉ:</span>
						<p id="user-detail__address"><%= purchaseHistory.order_delivery_address ?? 'NaN' %></p>
					</div>
				</div>
				<div class="purchase-detail__order-info__payment">
					<h5>
						<span class="material-symbols-outlined">credit_card</span>
						<span>HÌNH THỨC THANH TOÁN</span>
					</h5>
					<p id="order-info__payment-detail"><%= purchaseHistory.paying_method_name ?? 'NaN'%></p>
				</div>
			</div>
			<div class="purchase-detail__bill">
				<h5>
					<span class="material-symbols-outlined">local_mall</span>
					<span>THÔNG TIN SẢN PHẨM</span>
				</h5>
				<% let totalAmount = 0; %>
				<% purchaseHistory.order_details.forEach(purchaseDetail => { %>
				<%- include('../../components/purchase-detail-item', { purchaseDetail: purchaseDetail, toCurrency: formatFunction.toCurrency }) %>
				<% totalAmount += parseFloat(purchaseDetail.order_detail_price_after); %>
				<% }) %>
				<div class="purchase-detail__order-price">
					<p>
						<span>Thành tiền:</span>
						<span id="total-amount"><%= formatFunction.toCurrency(totalAmount) %></span>
					</p>
					<p class="purchase-detail__final">
						<span>Số tiền đã thanh toán:</span>
						<span id="paid-amount"><%= formatFunction.toCurrency(totalAmount) %></span>
					</p>
				</div>
				<div class="purchase-detail__button">
					<% if (purchaseHistory.order_status === 'Chờ thanh toán') { %>
					<!-- nút hủy khi status là "Chờ thanh toán" -->
					<a href="#">
						<div class="btn btn--outlined pri cancel">Hủy</div>
					</a>
					<!-- end -->

					<!-- nút thanh toán khi status là "Chờ thanh toán" -->
					<a href="#">
						<div class="btn btn--filled pri">Thanh toán</div>
					</a>
					<!-- end -->
					<% } %>
					<% if (purchaseHistory.order_status === 'Đang giao hàng') { %>
					<!-- nút đánh giá khi status là "Đang giao hàng"-->
					<a href="#">
						<div class="btn btn--filled pri disable">Đánh giá</div>
					</a>
					<!-- end -->
					<% } %>
					<% if (purchaseHistory.order_status === 'Hoàn thành') { %>
					<!-- nút đánh giá khi status là "Hoàn thành"-->
					<a href="#">
						<div class="btn btn--filled pri">Đánh giá</div>
					</a>
					<!-- end -->
					<% } %>
				</div>
			</div>
		</section>
	</main>

	<%- include('../../components/scrollup') %>
	<%- include('../../partials/footer') %>
	<%- include('../../partials/app-bar') %>

	<script src="/scripts/pages/account/purchaseDetail.js"></script>

</body>

</html>